generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id               String        @id @default(uuid())
  email            String        @unique
  password         String?
  role             Role
  name             String
  username         String        @unique
  refreshTokenHash String?
  isGoogleUser     Boolean       @default(false)
  picture          String?
  sessions         UserSession[] @relation("UserSessions")

  @@map("users")
}

enum Channel {
  REST
  SOCKET
  OTHER
}

model UserSession {
  id           String         @id @default(uuid())
  userId       String
  role         String
  jwtId        String?        @unique
  ipAddress    String?
  deviceInfo   String?
  socketId     String?
  channel      Channel?       // new: identifies how the session was created
  status       SessionStatus  @default(ACTIVE)
  lastActivity DateTime       @default(now())
  loginAt      DateTime       @default(now()) // new: explicit login time
  terminatedAt DateTime?
  duration     Int?            // new: session length in seconds
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  user         User           @relation("UserSessions", fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_sessions")
  @@index([jwtId])
  @@index([userId, status])    // new: helps queries like "active sessions for a user"
}

enum Role {
  USER
  ADMIN
}

enum SessionStatus {
  ACTIVE
  IDLE
  OFFLINE
  TERMINATED
}
